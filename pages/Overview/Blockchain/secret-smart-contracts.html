<psk-page title="Secret Smart Contracts">
	<psk-toc title="Table of contents"></psk-toc>
  <psk-chapter title="What is a Smart Contract?">
    <p align="justify">The Smart Contracts in PrivateSky are implementable with two special types of swarms” assets and transactions. When a PrivateSky smart contract is stored in a CSB Constitution  and contributed to the “server side” business part of a SSApp, we are talking about a special  kind of smart contracts.  The instances of CSB stored smart contracts are secret from the anchoring domain point of view and therefore they could easily manage secrets. Therefore we have decided to call them secret smart contracts.</p>
    <p align="justify">PrivateSky is not a single monolithic blockchain but a set of hierarchical blockchains called “blockchain domains”. In a way PrivateSky can be imagined as a blockchain composed from multiple smaller blockchain domains. In the root of the hierarchy we could put an existing public blockchain (like Bitcoin blockchain) or a permissioned blockchain.  The secret contract idea implies the creation of even more satellite domains. It is feasible for a small blockchain domain to be deployed for a group of secret smart contracts between a small number of organisations.  Therefore, PrivateSky could be imagined as a world where decentralisation means many independent but interoperable distributed applications: much more like web sites. We do not have the mindset of trying to build the perfect blockchain that should be used for all use cases. Each use case will require a customised solution. In line with this vision each PrivateSky implementation and each blockchain domain will run customised software that evolves independently, exactly as an internet domain.</p>
    <p align="justify">This approach could solve a series of existing issues with blockchains:</p>
    <ul>
    	<li>Solve scalability problems as we can create any number of smaller blockchain domains</li>
    	<li>Solve privacy related problems without reducing security: the whole data is still cryptographically fingerprinted within the root  domain (indirectly but equally safe). With this approach we will preserve the  security benefit in having a big number of participants in the network but without sharing unnecessary data (or sharing every blockchain write operation)  to every participant. Additionally, it provides confidentiality for scenarios where information may be deduced from simply observing the frequency that a party publishes transactions to a blockchain, even without knowing the contents (e.g. in supply chain use cases this could point to new product launches, shortages or recalls)</li>
    	<li>Removes limitations in adopting new  innovations and changes in  technology as each sub-domain can be upgraded and changed  independently</li>
    </ul>
  </psk-chapter>
  <psk-chapter title="Confidentiality issues">
    <p align="justify"><i>Secret Smart Contracts</i> represent a major innovation of the PrivateSky platform. While the commonly recognized advantage of private blockchains over the public ones is the increase in performance and scalability, the issue of confidentiality of transactions generated by smart contracts has not been resolved so far. This means that while smart contracts do their job, their input data and the results of their computation “surface” in unencrypted form and become visible to all the users of the blockchain. The Secret Smart Contracts support computation with the blockchain validator nodes being blind to the input data as well as to the results of the computation, while retaining the ability to validate them according to the Constitution of the blockchain.</p>

    <p align="justify">The key challenge and ambition are to achieve in the blockchain of the size and scope of PrivateSky the scalability and performance of a private blockchain without cutting security and confidentiality corners as the existing private blockchain standards do.  Security of the public blockchains is based on a large number of nodes having copies of the blockchain. This prevents a malicious actor from successfully attacking the Bitcoin blockchain: even if billions are spent on attacking Bitcoin by rewriting the blockchain, there would still be hundreds of thousands of people with the original copy on their nodes; the fact that the blockchain has been compromised would become immediately known, the community would freeze the blockchain and fork off to a different algorithm or method for security. This, however, does not hold for private blockchains. While, due to their small number of nodes, private blockchains offer significant performance and scalability advantages over the public ones, the small number of nodes renders their security insufficient.  Replication attacks or attacks on cryptographic primitives could result in blockchain history being rewritten by an attacker.</p>

    <p align="justify">The biggest security issue of the private blockchains is secure validation of execution of smart contracts.  If smart contracts verification is based only on a simple digital signature of the code, and many (disinterested) users do not verify that the transaction results are caused by the actual execution of the code, this “single source of truth” function of blockchain/DLT is not fulfilled due to the security weakness. Indeed, some of the current private distributed ledger standards such as Hyperledger Fabric or Corda, suffer from this drawback. PrivateSky, as a blockchain designed to digitize the entire industries, requires a more sophisticated approach regarding confidentiality of smart contracts.  Specifically, even the nodes that have performed the computation should be blind to its contents.  The Secret Smart Contracts technology supports smart contract computation with even the validator nodes themselves being blind to the input data and to the results of the computations, while retaining the ability to validate them.</p>

    <p align="justify">We have identified at least 3 types of use cases handling private data. They are depicted in the following table.</p>

    <psk-table header="true">
    	Use Case| Observations and research area
    	Public smart contracts on public data stored in CSBs | The secrets required to decrypt data from CSBs is public. This case is a valid one, because if you delete all other versions (backups) of a  CSB, you get a way to implement the right to be forgotten. The decryption key is in blockchain but the encrypted data could be deleted from the off-chain storage.  Additionally, this use case exemplifies how a hierarchy of blockchains can be constructed having CSBs as intermediate nodes. A CSB is also a blockchain just that the consent algorithm it is not anything like Proof of Work but rather classical distributed system algorithm and validation is replaced with access control rules and versioning.
    	Smart contracts handling  confidential data stored in CSBs | In this case the blockchain contains references to CSBs but does not embed secrets capable to decrypt or process data in these CSBs. In these cases, only an agent (a client side application - a wallet or a trusted software system) has the decryption keys. The code of the smart contracts could also be embedded in the CSB. The transactions started in the name of a smart contract can not be validated  by the whole network but only by the agents holding the decryption keys of the CSB.  This is a valid  and useful use case and offers a simple example of differentiation between choreographic smart contracts and the other smart contracts implementations. This approach is useful if you want to preserve confidentiality while still doing notarisation in blockchain so you can have valid evidence in a case of an arbitrage. The governance layer will trigger a human arbitrage scenario if a consortium  partner does not obey the rules of the contract.
    	Secret  smart contracts handling data with other restrictrictions | Our team is actively working on methods of using homomorphic encryption and multi-party computation (MPC)  to implement an execution engine for smart contracts by  doing computation on encrypted data. This work is aimed at extending the current CSB implementation to support multidimensional locked secrets in secret smart contracts.
    </psk-table>

    <p align="justify">The PrivateSky project will in addition investigate other solutions for transaction and smart contract confidentiality, including but not limited to: Zero Knowledge Proofs, Zero Knowledge Asset Transfer, Private Transactions and Private Channels; in order to contrast their applicability and benefits/drawbacks relative to the proposed Secret Smart Contracts.</p>
    <p align="justify">A choreographic smart contract is a long-living process that is serialised in the PrivateSky blockchain.</p>
    <p align="justify">The execution requires complex choreographies between multiple agents (decentralised identities) in order to accept changes of states in the blockchain serialisation. State changes are represented by state transitions when a smart contract is seen as a finite state machine. A smart contract execution environment ensures that all nodes are validating independently the execution of the smart contract and are rejecting those executions that do not follow the contract rules.</p>

    <psk-img title="PrivateSky - a technology to increase confidentiality" src="/assets/images/newlook/figure3.png"></psk-img>

    <p align="justify">From the confidentiality  perspective, we can identify multiple layers when building smart contracts:</p>

    <ol>
    	<li>The Self-Sovereign Storage Layers (S-SSL)</li>

    Secret Storage Layer will be based on the  Cloud Safe Boxes concept introduced by PrivateSky.  CSBs will offer shared control over bilateral facts and their evolution. This layer encrypts information while distributing keys to selected authorities or participants who can access it. In this way, the software allows permissioned clients to create and manage cryptographic secrets.

    	<li>The  Smart Contracts Layer (SCL) and the Secret sMart Contracts Layer (SMCL)</li>
    The SCL layer offers a similar concept of smart contracts comparable with other blockchains.  The SMCL layer will offer various types of encrypted smart contracts, encrypted choreographies, multi-party computation and choreographic smart contracts. This layer allows for the encryption of both the storage and the smart contract actual code, in order to ensure the privacy of any transaction, under the assumption that the authorizers can be trusted not to collude. This layer will be built starting from the results obtained as part of PrivateSky research  or from the results of another related privacy projects. We want to provide decentralized application (DApp) developers with some flexibility in concealing data. Secret contracts will provide a trusted execution environment for DApp developers to spin up smart contracts without publishing that information on-chain. The trusted execution environment consist of private storage facilities that SMCL secures the data in.

    	<li>The time-locked secrets and multidimensional locked secrets layer (MDLSL)</li>
    A time-lock is a way of securing a file or message until a certain time in the future. It is an important concept for whistleblowers, document embargoes, and blind auctions. Time-locking in practice has been difficult, especially on public blockchains like Ethereum. If users try to cheat the system, by falsifying data or publishing it too early, they will be penalized. Going forward, we can theorize that incentive schemes could be extended, so that time is not the only variable in releasing a secret.
</ol>

  </psk-chapter>
</psk-page>